<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>‡πÄ‡∏Ç‡∏¢‡πà‡∏≤‡πÄ‡∏ã‡∏µ‡∏¢‡∏°‡∏ã‡∏µ‡∏•‡∏∏‡πâ‡∏ô‡∏£‡∏±‡∏Å‡∏•‡∏∏‡πâ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô - Startup Up Real Estate</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
*{box-sizing:border-box}
html, body { height: 100%; width: 100%; overflow: hidden; position: fixed; margin: 0; padding: 0; background-color: #ff4d6d; }

/* ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡∏¥‡∏á‡∏Å‡πå Google Drive ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô Direct Link */
.bg-container {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background-image: url('https://lh3.googleusercontent.com/d/1K0BRvOY_r6-6YXI6VUbKDSMPivc9AE_E');
  background-size: cover; background-position: center; background-repeat: no-repeat; z-index: -1;
}

@media (max-width: 768px) {
  .bg-container {
    background-image: url('https://lh3.googleusercontent.com/d/1ERUqVLPAj1DBJl_AhkY-1TCClSK1rTnq');
  }
}

.bg-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.1); z-index: -1; }
body { font-family: 'Sarabun', sans-serif; color: white; display: flex; flex-direction: column; align-items: center; justify-content: space-between; }
h1 { text-align:center; margin: 4vh 0 0 0; font-size: clamp(18px, 5vw, 24px); text-shadow: 2px 2px 4px rgba(0,0,0,0.5); z-index: 5; }

#regForm { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: flex; align-items: center; justify-content: center; z-index: 1000; }
.reg-box { background: white; padding: 30px; border-radius: 20px; width: 90%; max-width: 320px; color: #333; }
.reg-box h2 { color: #ff4d6d; margin-top: 0; text-align: center; }
.reg-box input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 10px; font-size: 16px; }
.reg-box button { width: 100%; padding: 12px; background: #ff4d6d; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
#adminAuth { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; align-items: center; justify-content: center; z-index: 3000; }
#scene { position: relative; width: 100%; max-width: 360px; height: 55vh; display: flex; align-items: center; justify-content: center; }
#shakeGroup { position: relative; width: 180px; height: 400px; transform-origin: bottom center; transition: transform 0.1s; }
.shake { animation: shakeTube 0.4s infinite ease-in-out; }
@keyframes shakeTube {
  0%, 100% { transform: rotate(0deg) translateY(0); }
  25% { transform: rotate(4deg) translateY(-5px); }
  75% { transform: rotate(-4deg) translateY(-3px); }
}
@keyframes stickSwirl {
  0% { transform: translate(0, 0) rotate(var(--r)); }
  25% { transform: translate(3px, -10px) rotate(calc(var(--r) + 4deg)); }
  50% { transform: translate(-3px, -5px) rotate(calc(var(--r) - 3deg)); }
  75% { transform: translate(2px, -12px) rotate(calc(var(--r) + 2deg)); }
  100% { transform: translate(0, 0) rotate(var(--r)); }
}
.shake .stick { animation: stickSwirl var(--t) infinite ease-in-out; }
#tubeWrap { position: absolute; bottom: 0; width: 100%; height: 300px; z-index: 10; }
#tube {
  position: absolute; bottom: 0; width: 100%; height: 100%;
  background: linear-gradient(90deg, #ff4d6d 0%, #ff85a1 20%, #ffb3c1 50%, #ff85a1 80%, #ff4d6d 100%);
  border-radius: 0 0 40px 40px; box-shadow: inset 0 15px 15px rgba(255,255,255,0.4), 0 10px 20px rgba(0,0,0,0.3);
  border: 2px solid #ff0a54; 
  display: flex; justify-content: center; align-items: center; 
}
.tubeLogo { width: 80%; height: auto; mix-blend-mode: multiply; display: block; }
.stick { position: absolute; width: 24px; height: 260px; background: linear-gradient(to bottom, #fff0f3 0%, #ffccd5 15%, #ff85a1 15%, #ff4d6d 100%); border-radius: 6px 6px 2px 2px; bottom: 100px; z-index: 3; display: flex; justify-content: center; padding-top: 8px; font-size: 16px; font-weight: bold; color: #ff0a54; }
.s1{left:20px; transform: rotate(-5deg); --r:-5deg; --t:0.35s;} 
.s2{left:50px; transform: rotate(-2deg); --r:-2deg; --t:0.42s;} 
.s3{left:80px; transform: rotate(1deg); --r:1deg; --t:0.38s;} 
.s4{left:110px; transform: rotate(3deg); --r:3deg; --t:0.45s;} 
.s5{left:135px; transform: rotate(6deg); --r:6deg; --t:0.32s;} 
#mainStick{ left:78px; --r:0deg; --t:0.4s;}
.fly { z-index: 99 !important; animation: shootUp 0.4s ease-out forwards, projectileDrop 0.8s 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; }
@keyframes shootUp { 100% { transform: translateY(-300px) rotate(15deg); } }
@keyframes projectileDrop { 0% { transform: translateY(-300px) rotate(15deg); } 100% { transform: translate(60px, 230px) rotate(81deg); } }
button.draw-btn { width: 80%; max-width: 280px; padding: 16px; font-size: 20px; border: none; border-radius: 40px; background: linear-gradient(#ff85a1, #ff4d6d); color: white; font-weight: bold; box-shadow: 0 6px 0 #c9184a, 0 8px 15px rgba(0,0,0,0.3); cursor: pointer; margin-bottom: 5vh; }
#overlay{ position:fixed; inset:0; background:rgba(0,0,0,.85); display:flex; align-items:center; justify-content:center; opacity:0; pointer-events:none; transition:.4s; z-index:999; }
#overlay.show{ opacity:1; pointer-events:auto; }
.card { width: 300px; height: 420px; }
.cardInner{ width:100%; height:100%; position:relative; transform-style:preserve-3d; transition:.9s; }
.card.flip .cardInner{ transform:rotateY(180deg); }
.face{ position:absolute; inset:0; backface-visibility:hidden; border-radius:20px; padding:24px; display:flex; flex-direction:column; align-items:center; justify-content:center; }
.front{ background:#ff758f; color:white; font-size: 28px; font-weight: bold; border: 4px solid white; }
.back{ background:#fff; color:#ff0a54; transform:rotateY(180deg); text-align: center; border: 4px solid #ff85a1; }
.closeBtn{ position:absolute; top:10px; right:10px; width:32px; height:32px; border-radius:50%; background:#ff4d6d; color:white; border: none; z-index: 10; }
#promoText { margin-top: 15px; font-weight: bold; line-height: 1.4; color: #333; font-size: 14px; white-space: pre-line; }
#previewScreen { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 2000; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 10px; }
#previewImage { max-width: 240px; border-radius: 15px; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
#previewScreen h3 { font-size: 16px; text-align: center; color: #fff; margin: 10px 0; }
#adminPanel { position: fixed; inset: 0; background: white; color: #333; padding: 20px; overflow-y: auto; display: none; z-index: 2000; }
.history-item { border-bottom: 1px solid #ddd; padding: 10px; display: flex; justify-content: space-between; align-items: center; }
.del-btn { background: #ff4d6d; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
</style>
</head>

<body>
<div class="bg-container"></div>
<div class="bg-overlay"></div>

<div id="regForm">
  <div class="reg-box">
    <h2 id="regTitle">‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏•‡∏∏‡πâ‡∏ô‡πÇ‡∏ä‡∏Ñ</h2>
    <input type="text" id="uName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
    <input type="tel" id="uTel" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå (10 ‡∏´‡∏•‡∏±‡∏Å)" maxlength="10">
    <button id="regSubmitBtn" onclick="checkAndStart()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡∏¢‡πà‡∏≤‡∏•‡∏∏‡πâ‡∏ô‡∏£‡∏±‡∏Å</button>
    <p style="font-size: 12px; text-align: center; margin-top: 10px; color: #666; cursor: pointer;" onclick="showAuthBox()">Admin Login</p>
  </div>
</div>

<div id="adminAuth">
  <div class="reg-box">
    <h2>Admin Login</h2>
    <input type="password" id="adminPw" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
    <button onclick="verifyAdmin()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</button>
    <button onclick="hideAuthBox()" style="background:#666; margin-top:5px;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
  </div>
</div>

<h1>üíñ ‡πÄ‡∏Ç‡∏¢‡πà‡∏≤‡πÄ‡∏ã‡∏µ‡∏¢‡∏°‡∏ã‡∏µ‡∏•‡∏∏‡πâ‡∏ô‡∏£‡∏±‡∏Å‡∏•‡∏∏‡πâ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô üíñ</h1>

<div id="scene">
  <div id="shakeGroup">
    <div class="stick s1">‚ù§</div><div class="stick s2">‚ù§</div><div class="stick s3">‚ù§</div>
    <div class="stick s4">‚ù§</div><div class="stick s5">‚ù§</div><div class="stick" id="mainStick">‚ù§</div>
    <div id="tubeWrap">
      <div id="tube">
        <img src="http://googleusercontent.com/profile/picture/7" class="tubeLogo" alt="Startup Up Logo">
      </div>
    </div>
  </div>
</div>

<button class="draw-btn" id="drawBtn" onclick="draw()" disabled style="opacity:0.5;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Å‡πà‡∏≠‡∏ô</button>

<div id="overlay">
  <div class="card" id="card">
    <div class="cardInner" id="cardInner">
      <div class="face front">‡πÄ‡∏õ‡∏¥‡∏î‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏£‡∏±‡∏Å</div>
      <div class="face back" id="captureArea">
        <button class="closeBtn" onclick="closeCard()">√ó</button>
        <h2 id="cNo" style="margin:0"></h2>
        <p id="cText" style="font-size: 20px; color: #ff4d6d; font-weight: bold; margin: 10px 0;"></p>
        <hr style="width:100%; border: 0.5px solid #ffe5ec">
        <p id="promoText"></p>
        <button id="saveBtn" onclick="saveAsImage()" style="margin-top:20px; background:#ff4d6d; color:#fff; border:none; padding:12px; border-radius:25px; cursor:pointer; font-weight:bold; width: 100%;">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ</button>
      </div>
    </div>
  </div>
</div>

<div id="previewScreen">
  <h3>‡πÅ‡∏ï‡∏∞‡∏Ñ‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏π‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠ '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å'</h3>
  <img id="previewImage" src="" alt="‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
  <button onclick="closePreview()" style="margin-top:20px; background:#666; border:none; padding:10px 20px; color:white; border-radius:10px; cursor:pointer;">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢</button>
</div>

<div id="adminPanel">
  <div style="display:flex; justify-content: space-between; align-items:center;">
    <h2>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ)</h2>
    <button onclick="closeAdmin()" style="padding:10px;">‡∏õ‡∏¥‡∏î</button>
  </div>
  <div id="historyList"></div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzyz9fL8UNW0fdqzELT31UEts5mDgsFsj-7xwLDMWmlNHsXzJfjRaXQfzzKJrfvbgqtdQ/exec";

let currentUser = null;
const data=[{no:"1", text:"‡∏ó‡∏£‡∏¥‡∏õ‡∏î‡∏¥‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡∏´‡∏£‡∏π + ‡πÇ‡∏ã‡∏ü‡∏≤‡∏Ñ‡∏π‡πà‡∏£‡∏±‡∏Å"},{no:"2", text:"‡∏ï‡∏π‡πâ‡πÄ‡∏¢‡πá‡∏ô‡πÉ‡∏´‡∏ç‡πà + ‡∏ä‡∏∏‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏£‡∏±‡∏ß‡∏ä‡∏°‡∏û‡∏π"},{no:"3", text:"‡πÅ‡∏≠‡∏£‡πå‡πÄ‡∏¢‡πá‡∏ô‡∏â‡πà‡∏≥ + ‡∏ó‡∏µ‡πà‡∏ô‡∏≠‡∏ô‡∏Ñ‡∏¥‡∏á‡πÑ‡∏ã‡∏™‡πå"},{no:"4", text:"‡πÅ‡∏´‡∏ß‡∏ô‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ó‡∏ô‡πÉ‡∏à 1 ‡∏™‡∏•‡∏∂‡∏á"}];
const slogans = [
  "‡∏Å‡∏π‡πâ‡∏á‡πà‡∏≤‡∏¢ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÑ‡∏ß ‡πÑ‡∏î‡πâ‡∏ö‡πâ‡∏≤‡∏ô‡πÉ‡∏ô‡∏ù‡∏±‡∏ô‡∏Å‡∏±‡∏ö Startup Up!\n‡∏ú‡πà‡∏≠‡∏ô‡πÄ‡∏ö‡∏≤‡∏™‡∏ö‡∏≤‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤ ‡∏¢‡∏∑‡πà‡∏ô‡∏Å‡∏π‡πâ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏£‡∏±‡∏ö‡πÇ‡∏ä‡∏Ñ‡∏ü‡∏£‡∏µ!",
  "‡∏≠‡∏¢‡∏≤‡∏Å‡∏°‡∏µ‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏≤‡∏Å Startup Up ‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏Å‡∏π‡πâ‡∏á‡πà‡∏≤‡∏¢‡∏ó‡∏±‡∏ô‡πÉ‡∏à\n‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏π‡∏á‡∏Å‡∏π‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏£‡πâ‡∏≠‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏≤‡∏ß‡∏ô‡πå ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏û‡∏¥‡πÄ‡∏®‡∏©!",
  "‡∏£‡∏±‡∏Å‡∏´‡∏ß‡∏≤‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏™‡∏ß‡∏¢ ‡∏¢‡∏∑‡πà‡∏ô‡∏Å‡∏π‡πâ‡∏ö‡πâ‡∏≤‡∏ô‡∏Å‡∏±‡∏ö Startup Up ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡πá‡∏ß‡∏ä‡∏±‡∏ß‡∏£‡πå\n‡∏î‡∏π‡πÅ‡∏•‡∏ó‡∏∏‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏á‡πà‡∏≤‡∏¢!",
  "‡πÄ‡∏Ç‡∏¢‡πà‡∏≤‡πÄ‡∏à‡∏≠‡∏£‡∏±‡∏Å ‡∏£‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡∏™‡∏∏‡∏î‡∏Ñ‡∏∏‡πâ‡∏°\n‡∏Å‡∏π‡πâ‡∏á‡πà‡∏≤‡∏¢ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÑ‡∏ß ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡πÉ‡∏ô‡∏ù‡∏±‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!",
  "‡∏£‡∏±‡∏Å‡πÅ‡∏ó‡πâ‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï ‡∏¢‡∏∑‡πà‡∏ô‡∏Å‡∏π‡πâ‡∏ö‡πâ‡∏≤‡∏ô‡∏Å‡∏±‡∏ö Startup Up ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ\n‡∏ú‡πà‡∏≠‡∏ô‡∏™‡∏ö‡∏≤‡∏¢‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÇ‡∏ä‡∏Ñ‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡∏ö‡πâ‡∏≤‡∏ô‡∏ü‡∏£‡∏µ!"
];

async function checkAndStart() {
  const name = document.getElementById('uName').value;
  const tel = document.getElementById('uTel').value;
  if(!name || tel.length < 10) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
  
  const submitBtn = document.getElementById('regSubmitBtn');
  submitBtn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå...";
  submitBtn.disabled = true;

  try {
    const response = await fetch(`${SCRIPT_URL}?phone=${tel}`);
    const result = await response.json();
    
    if(result.exists) {
      alert('‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢! ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏Ñ‡∏¢‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á)');
      submitBtn.innerText = "‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡∏¢‡πà‡∏≤‡∏•‡∏∏‡πâ‡∏ô‡∏£‡∏±‡∏Å";
      submitBtn.disabled = false;
      return;
    }

    let localHistory = JSON.parse(localStorage.getItem('startup_history') || "[]");
    if(localHistory.find(h => h.tel === tel)) {
       alert('‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÄ‡∏Ñ‡∏¢‡πÉ‡∏ä‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö');
       submitBtn.innerText = "‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡∏¢‡πà‡∏≤‡∏•‡∏∏‡πâ‡∏ô‡∏£‡∏±‡∏Å";
       submitBtn.disabled = false;
       return;
    }

    currentUser = { name, tel };
    document.getElementById('regForm').style.display = 'none';
    document.getElementById('drawBtn').disabled = false;
    document.getElementById('drawBtn').style.opacity = '1';
    document.getElementById('drawBtn').innerText = '‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡∏¢‡πà‡∏≤‡∏´‡∏±‡∏ß‡πÉ‡∏à';
  } catch (err) {
    alert("‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á");
    submitBtn.innerText = "‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡∏¢‡πà‡∏≤‡∏•‡∏∏‡πâ‡∏ô‡∏£‡∏±‡∏Å";
    submitBtn.disabled = false;
  }
}

async function draw(){
  const drawBtn = document.getElementById('drawBtn');
  drawBtn.disabled = true;
  
  const overlay = document.getElementById('overlay');
  const card = document.getElementById('card');
  const mainStick = document.getElementById('mainStick');
  const shakeGroup = document.getElementById('shakeGroup');
  
  overlay.classList.remove("show"); card.classList.remove("flip"); mainStick.classList.remove("fly");
  document.querySelectorAll('.stick').forEach(s => s.innerText = "‚ù§");
  shakeGroup.classList.add("shake");

  setTimeout(async ()=>{
    shakeGroup.classList.remove("shake");
    const pick = data[Math.floor(Math.random()*data.length)];
    const randomSlogan = slogans[Math.floor(Math.random()*slogans.length)];
    
    mainStick.innerText = pick.no; 
    mainStick.classList.add("fly");

    await saveToGoogleSheet(currentUser.name, currentUser.tel, pick.text);
    saveHistory(currentUser.name, currentUser.tel, pick.text);

    setTimeout(()=>{
      document.getElementById('cNo').innerText = "‡πÉ‡∏ö‡∏ó‡∏µ‡πà "+pick.no;
      document.getElementById('cText').innerText = "‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: " + pick.text;
      document.getElementById('promoText').innerText = randomSlogan;
      overlay.classList.add("show");
      setTimeout(()=>card.classList.add("flip"), 300);
    }, 1000);
  }, 1200);
}

async function saveToGoogleSheet(name, phone, result) {
  try {
    const payload = { name, phone, result };
    await fetch(SCRIPT_URL, {
      method: 'POST',
      body: JSON.stringify(payload)
    });
  } catch (err) {
    console.error("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Sheet ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", err);
  }
}

async function saveAsImage() {
  const area = document.getElementById('captureArea');
  const saveBtn = document.getElementById('saveBtn');
  const closeBtn = area.querySelector('.closeBtn');
  saveBtn.style.opacity = '0'; closeBtn.style.opacity = '0';
  const originalTransform = area.style.transform;
  area.style.transform = 'none';

  try {
    const canvas = await html2canvas(area, { backgroundColor: "#ffffff", scale: 1.5, useCORS: true });
    const imgData = canvas.toDataURL('image/png');
    document.getElementById('previewImage').src = imgData;
    document.getElementById('previewScreen').style.display = 'flex';
  } catch (err) {
    alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏Ñ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÅ‡∏ó‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö");
  } finally {
    area.style.transform = originalTransform;
    saveBtn.style.opacity = '1'; closeBtn.style.opacity = '1';
  }
}

function closePreview() { document.getElementById('previewScreen').style.display = 'none'; }
function saveHistory(name, tel, prize) {
  let history = JSON.parse(localStorage.getItem('startup_history') || "[]");
  history.push({ name, tel, prize, date: new Date().toLocaleString('th-TH') });
  localStorage.setItem('startup_history', JSON.stringify(history));
}
function showAuthBox() { document.getElementById('adminAuth').style.display = 'flex'; }
function hideAuthBox() { document.getElementById('adminAuth').style.display = 'none'; }
function verifyAdmin() {
  if(document.getElementById('adminPw').value === "SURE0635824615") {
    hideAuthBox(); document.getElementById('adminPanel').style.display = 'block'; renderHistory();
  } else { alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"); }
}
function closeAdmin() { document.getElementById('adminPanel').style.display = 'none'; }
function renderHistory() {
  const list = document.getElementById('historyList');
  let history = JSON.parse(localStorage.getItem('startup_history') || "[]");
  list.innerHTML = history.length ? "" : "<p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>";
  history.forEach((h, index) => {
    list.innerHTML += `<div class="history-item"><div><b>${h.name}</b> (${h.tel})<br><small>${h.prize} - ${h.date}</small></div>
    <button class="del-btn" onclick="deleteHistory(${index})">‡∏•‡∏ö</button></div>`;
  });
}
function deleteHistory(index) {
  if(!confirm("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?")) return;
  let history = JSON.parse(localStorage.getItem('startup_history') || "[]");
  history.splice(index, 1);
  localStorage.setItem('startup_history', JSON.stringify(history));
  renderHistory();
}
function closeCard(){ location.reload(); }
</script>
</body>
</html>
